(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{368:function(t,a,s){"use strict";s.r(a);var n=s(14),e=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("p",[t._v("@[toc]")]),t._v(" "),a("h2",{attrs:{id:"浏览器渲染流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#浏览器渲染流程"}},[t._v("#")]),t._v(" 浏览器渲染流程")]),t._v(" "),a("h3",{attrs:{id:"资源请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#资源请求"}},[t._v("#")]),t._v(" 资源请求")]),t._v(" "),a("p",[t._v("当我们在地址栏输入目标地址的时候，浏览器首先需要进行资源请求。在资源请求过程中，浏览器会用一些机制来加快资源的响应，下面是资源请求的全过程：")]),t._v(" "),a("h4",{attrs:{id:"dns-查询"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-查询"}},[t._v("#")]),t._v(" DNS 查询")]),t._v(" "),a("p",[t._v("当我们输入目标的域名的时候，客户端需要找到对应资源的位置。例如输入https://example.com HTML页面被定为到112.12.12.12 的服务器，如果之前没有访问过这个网站，就需要"),a("code",[t._v("进行DNS查询")]),t._v("，即"),a("code",[t._v("通过域名来获取对应的IP地址")]),t._v("。")]),t._v(" "),a("p",[t._v("DNS 查询，是浏览器向域名服务器发起一个DNS 请求，最终这个域名服务器返回一个"),a("code",[t._v("IP地址")]),t._v("。这个IP地址就是浏览器获取资源的真实路径。第一个向DNS 查询得到IP后，浏览器会将IP于域名匹配存入缓存中，一段时间内，直接从缓存获取即可，无需向DNS服务器获取。")]),t._v(" "),a("p",[t._v("如果"),a("code",[t._v("字体、图片、脚本等资源的域名不同")]),t._v("，则需要对"),a("code",[t._v("每一个域名都进行一次DNS查询")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"tcp握手"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcp握手"}},[t._v("#")]),t._v(" TCP握手")]),t._v(" "),a("p",[t._v("通过DNS服务器获取到IP地址后，客户端要向目标主机，"),a("code",[t._v("发起会话连接")]),t._v("，此时"),a("code",[t._v("需要先通过TCP进行三次握手")]),t._v("，这个发生"),a("code",[t._v("在http发送数据之前")]),t._v("，通过TCP握手，可以"),a("code",[t._v("协商网络套接字连接")]),t._v("的一些"),a("code",[t._v("参数")]),t._v("。")]),t._v(" "),a("p",[t._v("之所以要进行三次握手，是为了确认连接的可靠性和稳定性，避免潜在的网络问题导致的资源浪费和传输混乱。")]),t._v(" "),a("p",[t._v("如果只是进行两次握手，"),a("code",[t._v("有可能一方未做好准备")]),t._v("而"),a("code",[t._v("一方已做好连接准备好的情况")]),t._v("，或者"),a("code",[t._v("客户端在第一次发送SYN后")]),t._v("，"),a("code",[t._v("宕机")]),t._v("，"),a("code",[t._v("重新连接后")]),t._v("，可能收到数据是宕机前发送的请求与重新连接请求不一致。")]),t._v(" "),a("h4",{attrs:{id:"tsl协商"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tsl协商"}},[t._v("#")]),t._v(" TSL协商")]),t._v(" "),a("p",[t._v("如果发起的是"),a("code",[t._v("https")]),t._v("请求，还需要另一次握手，这个握手，就是"),a("code",[t._v("TLS协商")]),t._v("，"),a("code",[t._v("决定了使用哪种密码对通信进行加密")]),t._v("，验证服务器。并在实际传输前建立安全连接，这就需要在"),a("code",[t._v("实际发送内容之前")]),t._v("，"),a("code",[t._v("在建立TCP连接之后")]),t._v("，再往返"),a("code",[t._v("服务器五次")]),t._v("。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/direct/29fd5ddfc1ed4a638f1aef8a3fe1c05b.png",alt:"在这里插入图片描述"}})]),t._v(" "),a("h3",{attrs:{id:"响应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#响应"}},[t._v("#")]),t._v(" 响应")]),t._v(" "),a("p",[t._v("经过 8 次往返，浏览器终于可以发出请求。"),a("code",[t._v("当浏览器发送一个http请求时")]),t._v("，这个请求通常是"),a("code",[t._v("HTML文件")]),t._v("，一旦"),a("code",[t._v("服务器收到请求")]),t._v("，他就使用"),a("code",[t._v("相关的响应头")]),t._v("和"),a("code",[t._v("HTML内容")]),t._v("进行回复")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token doctype"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<!")]),a("span",{pre:!0,attrs:{class:"token doctype-tag"}},[t._v("doctype")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token name"}},[t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("html")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("lang")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("zh-CN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("meta")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("charset")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("UTF-8"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("简单的页面"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("title")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("styles.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("myscript.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("head")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("h1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("heading"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("我的页面"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("h1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("含有"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("a")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("https://example.com/about"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("链接"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("的段落。"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("myimage.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("图像描述"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("anotherscript.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("body")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("html")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br")])]),a("h3",{attrs:{id:"解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解析"}},[t._v("#")]),t._v(" 解析")]),t._v(" "),a("p",[t._v("TCP 数据包在传输过程中，"),a("code",[t._v("数据会被分为若干段")]),t._v("，"),a("code",[t._v("一旦浏览器收到第一块数据")]),t._v("，就开始了"),a("code",[t._v("解析工作")]),t._v("。这个解析，指的是，通过接收数据，"),a("code",[t._v("转换成DOM 和CSSOM 的步骤")]),t._v(",通过渲染器把DOM和CSSOM 在"),a("code",[t._v("屏幕上绘制成页面")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"dom构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom构建"}},[t._v("#")]),t._v(" DOM构建")]),t._v(" "),a("p",[a("code",[t._v("DOM 树描述了文档的内容")]),t._v("。")]),a("html",[t._v(" 元素是"),a("code",[t._v("第一个标签也是文档树的根节点")]),t._v("。树反映了不同标记之间的关系和层次结构。嵌套在其他标记中的标记是子节点。DOM 节点的数量越多，构建 DOM 树所需的时间就越长。"),a("p"),t._v(" "),a("p",[a("img",{attrs:{src:"https://img-blog.csdnimg.cn/direct/72116a07a073457faa61bbf455194aa3.png",alt:"在这里插入图片描述"}}),t._v("\n在DOM解析过程中，会遇到图片、脚本、样式文件等资源，如LINK标签为CSS样式文件、script为脚本。这些资源对解析影响是不同的。")]),t._v(" "),a("p",[t._v("如果遇到CSS文件，解析器会继续进行。"),a("code",[t._v("CSS文件会构建成CSSOM")]),t._v(" ，"),a("code",[t._v("CSSOM 和DOM")]),t._v("构建是"),a("code",[t._v("并行的")]),t._v("。")]),t._v(" "),a("p",[t._v("但如果"),a("code",[t._v("遇到没有 defer或者async 字段的脚本")]),t._v("，"),a("code",[t._v("DOM树解析会停止")]),t._v("，"),a("code",[t._v("直到将脚本执行完毕后")]),t._v("，才接着执行解析任务。虽然预加载扫描器会优化这个过程，但过多的脚本仍然是一个重要的瓶颈。")]),t._v(" "),a("p",[t._v("浏览器为了优化解析DOM，其他资源带来的阻塞问题，引入了"),a("code",[t._v("预加载扫描器")]),t._v("技术")]),t._v(" "),a("h4",{attrs:{id:"预加载扫描器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#预加载扫描器"}},[t._v("#")]),t._v(" 预加载扫描器")]),t._v(" "),a("p",[t._v("浏览器在构建DOM 的时候，占用了主线程，"),a("code",[t._v("同时预加载扫码器也在将后台运行")]),t._v("，他会扫"),a("code",[t._v("描整一个HTML文件")]),t._v("，如果遇到"),a("code",[t._v("css、JavaScript或者web字体")]),t._v("，会在后台发起"),a("code",[t._v("资源请求并下载")]),t._v("。等到DOM"),a("code",[t._v("解析器解析")]),t._v("到这些"),a("code",[t._v("文件的引用的时候")]),t._v("，可能这些"),a("code",[t._v("文件已经下载完毕")]),t._v("或者"),a("code",[t._v("已经在运行")]),t._v("。这样就减少了阻塞")]),t._v(" "),a("div",{staticClass:"language-html line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("link")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("rel")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("stylesheet"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("href")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("styles.css"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("myscript.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("img")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("myimage.jpg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("alt")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("图像描述"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("script")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("src")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("anotherscript.js"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("async")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token script"}}),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("script")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("在上面的例子中，当主线程解析HTML和CSS 时，预加载扫描器发现了脚本和图像，并开始下载他们。为了确认脚本不会阻塞进程，当JavaScript解析和执行顺序不重要时，可以添加async 或defer属性。")]),t._v(" "),a("p",[a("code",[t._v("等待获取 CSS")]),t._v(" "),a("code",[t._v("不会阻塞 HTML 的解析或者下载")]),t._v("，但是它确实"),a("code",[t._v("会阻塞 JavaScript执行")]),t._v("，因为 JavaScript 经常用于查询元素的 CSS 属性。也就是说，当遇到CSS时，不会影响主线程解析DOM，但会阻塞JavaScript文件加载。")]),t._v(" "),a("h4",{attrs:{id:"cssom-构建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cssom-构建"}},[t._v("#")]),t._v(" CSSOM 构建")]),t._v(" "),a("p",[t._v("在解析DOM 时，会并行解析CSS，并进行CSSOM 的构建，CSSOM对象模型和DOM是相似的。但DOM和CSSOM是独立的两棵树，数据结构是独立的。")]),t._v(" "),a("p",[t._v("浏览器将CSS规则转换为可以理解和使用的样式映射。浏览器遍历CSS中每个规则集，根据css选择器创建具有父子级、兄弟关系的节点树。")]),t._v(" "),a("p",[t._v("构建时间CSSOM的速度很快，其时间通常小于一次DNS查询所需时间。")]),t._v(" "),a("h4",{attrs:{id:"其他过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他过程"}},[t._v("#")]),t._v(" 其他过程")]),t._v(" "),a("h5",{attrs:{id:"javascript编译"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#javascript编译"}},[t._v("#")]),t._v(" JavaScript编译")]),t._v(" "),a("p",[t._v("在解析css 和创建CSSOM 的同时，包括JavaScript文件在内的资源也会在下载。\nJavaScript下载完之后，"),a("code",[t._v("会被解析、编译和解释")]),t._v("。脚本被"),a("code",[t._v("解析为抽象语法树")]),t._v("。\n有些浏览器会"),a("code",[t._v("将抽象语法树输入编译器")]),t._v("，"),a("code",[t._v("输出字节码")]),t._v("，这就是"),a("code",[t._v("所谓的编译")]),t._v("。大部分代码是在主线程上解释的。")]),t._v(" "),a("h5",{attrs:{id:"构建无障碍树"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#构建无障碍树"}},[t._v("#")]),t._v(" 构建无障碍树")]),t._v(" "),a("p",[t._v("浏览器还构建辅助设备用于分析和解释内容的无障碍树。无障碍对象模型（AOM）类似于 DOM 的语义版本。当 DOM 更新时，浏览器会更新辅助功能树。辅助技术本身无法修改无障碍树。")]),t._v(" "),a("h3",{attrs:{id:"渲染"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染"}},[t._v("#")]),t._v(" 渲染")]),t._v(" "),a("p",[t._v("等待DOM和CSSOM 构建完毕，渲染开始，其步骤包括样式、布局、绘制，在某些情况下还包含合成。")]),t._v(" "),a("p",[t._v("CSSOM 和 CSSOM 树会"),a("code",[t._v("组合成一个渲染树")]),t._v("，然后浏览器用这个树，计算"),a("code",[t._v("每一个可见元素的布局")]),t._v("，然后将"),a("code",[t._v("其绘制到屏幕上")]),t._v("。\n在某些情况下，我们可以"),a("code",[t._v("将内容提升到她们自己的层并进行合成")]),t._v("，"),a("code",[t._v("通过GPU而不是CPU")]),t._v("绘制到屏幕的一部分来"),a("code",[t._v("提高性能")]),t._v("，从而释放主线程。")]),t._v(" "),a("h4",{attrs:{id:"样式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#样式"}},[t._v("#")]),t._v(" 样式")]),t._v(" "),a("p",[t._v("下面的元素将不会被显示，如")]),a("head",[t._v("元素及其子元素，以及任何带有display：none 的节点。但visibility：hidden 会被渲染，并占用空间。"),a("p"),t._v(" "),a("p",[t._v("每个可见节点都会匹配对应的CSSOM规则，与此确定每个节点的计算样式。")]),t._v(" "),a("h4",{attrs:{id:"布局"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#布局"}},[t._v("#")]),t._v(" 布局")]),t._v(" "),a("p",[t._v("渲染树上运行布局运行，是计算每个节点的高度、宽度、和位置。以及确认页面上每个对象的大小和位置的过程。")]),t._v(" "),a("p",[a("code",[t._v("第一次确定节点的大小和位置")]),t._v("称为"),a("code",[t._v("布局")]),t._v("。随后"),a("code",[t._v("对节点大小和位置的重新计算")]),t._v("称为"),a("code",[t._v("回流")]),t._v("。在我们的示例中，假设"),a("code",[t._v("初始的布局发生在图片之前")]),t._v("，"),a("code",[t._v("由于我们没有声明图片的尺寸")]),t._v("，因此"),a("code",[t._v("一旦知道图片的尺寸")]),t._v("，就会"),a("code",[t._v("出现回流")]),t._v("。")]),t._v(" "),a("h4",{attrs:{id:"绘制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#绘制"}},[t._v("#")]),t._v(" 绘制")]),t._v(" "),a("p",[t._v("最后一步是将节点绘制到屏幕上，第一次出现的节点名称为first meningful paint。在绘制或者光栅化阶段，浏览器会将在"),a("code",[t._v("布局阶段计算好")]),t._v("的每个框"),a("code",[t._v("转换成屏幕实际的像素")]),t._v("。")]),t._v(" "),a("p",[t._v("绘制包括将元素的每个可视部分绘制到屏幕，包含文本、颜色、边框、阴影等")]),t._v(" "),a("h4",{attrs:{id:"合成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合成"}},[t._v("#")]),t._v(" 合成")]),t._v(" "),a("p",[t._v("当文档每个部分以不同层绘制的时候，相互重叠，必须进行合成绘制，以确保正确的顺序绘制到屏幕上。")]),t._v(" "),a("h3",{attrs:{id:"交互"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#交互"}},[t._v("#")]),t._v(" 交互")]),t._v(" "),a("p",[t._v("一旦主线程绘制完成，可能主线程还没准备好给我交互的机会，因为可能还需要加载JavaScript（延迟到onload事件执行），这个时候是无法用于滚动、触摸和其他交互。")]),t._v(" "),a("h2",{attrs:{id:"回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#回流"}},[t._v("#")]),t._v(" 回流")]),t._v(" "),a("p",[t._v("当DOM发生变化，引起元素几何信息发生改变的时候（如大小和位置），浏览器需要重新计算几何属性，会触发回流，使得最新的元素布局渲染到页面上。")]),t._v(" "),a("p",[t._v("回流是一个"),a("code",[t._v("成本较高的操作")]),t._v("，因为它可能会"),a("code",[t._v("导致整个页面")]),t._v("或者页面"),a("code",[t._v("大部分布局")]),t._v("重新计算。")]),t._v(" "),a("p",[a("code",[t._v("一个元素的回流")]),t._v("可能会引起他"),a("code",[t._v("所有的子元素")]),t._v("、"),a("code",[t._v("后续兄弟")]),t._v("以及"),a("code",[t._v("祖先节点")]),t._v("的回流。")]),t._v(" "),a("h3",{attrs:{id:"引发回流的属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引发回流的属性"}},[t._v("#")]),t._v(" 引发回流的属性")]),t._v(" "),a("p",[t._v("引发回流的属性主要包括集合属性和影响布局的属性，以下是一些常见的属性和方法")]),t._v(" "),a("ul",[a("li",[t._v("几何属性的变化，width、height、border、font-size属性发生变化时，会发生回流")]),t._v(" "),a("li",[t._v("窗口大小变化：该表浏览器窗口大小或者滚动位置也会引发回流")]),t._v(" "),a("li",[t._v("增加或者移除样式表文件：动态添加或者移除标签引用的css文件会触发回流。")]),t._v(" "),a("li",[t._v("内容变化：例如在"),a("input"),t._v("标签输入文字、或者修改DOM元素的文本内容、可能会导致元素尺寸变化，引发回流")]),t._v(" "),a("li",[t._v("激活css伪类：如鼠标停顿触发hover类")]),t._v(" "),a("li",[t._v("操作class属性：通过JavaScript新增或者减少元素的class属性，从而改变元素的样式，可能会引发回流。")])]),t._v(" "),a("h3",{attrs:{id:"减少回流"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#减少回流"}},[t._v("#")]),t._v(" 减少回流")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("将需要修改的属性"),a("code",[t._v("封装到class 类中")]),t._v("。\n"),a("code",[t._v("尽量一次性更改元素")]),t._v("的样式，而"),a("code",[t._v("不是逐项更改")]),t._v("。我们可以通过"),a("code",[t._v("定义一个新的class")]),t._v("，然后将这个class"),a("code",[t._v("应用到元素上")]),t._v("实现。")])]),t._v(" "),a("li",[a("p",[t._v("使用"),a("code",[t._v("css属性简写")]),t._v("\n使用css简写可以减少重绘和回流的次数。例如，使用border代替单独的border-with、border-style、border-color")])]),t._v(" "),a("li",[a("p",[t._v("避免使用"),a("code",[t._v("table布局")]),t._v("\ntable布局中，一旦触发回流，表格所有元素都会发生回流")])]),t._v(" "),a("li",[a("p",[t._v("DOM离线处理\n即在当前真实DOM 树之外，创建一份新的文本，在内存中创建和修改节点，然后再将他们新增到文档中，这样避免回流和重绘次数。")])])]),t._v(" "),a("p",[t._v("具体步骤如下：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("1.创建一个新的document对象，用于内存操作DOM\n2.将要修改的DOM元素从当前文档移除，并添加到新的Document对象中\n3.对新的文档对象进行DOM的修改操作\n4将修改后的DOM元素从新的document移除，并添加会原始的文档中\n")])])]),a("p",[t._v("示例代码如下")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取要修改的列表项")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" listItem "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'list-item'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 创建一个新的Document对象")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" newDoc "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("implementation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("createHTMLDocument")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将要修改的列表项从当前文档中移除，并添加到新的Document对象中")]),t._v("\nnewDoc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("listItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 对新Document对象中的列表项进行修改")]),t._v("\nnewDoc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("backgroundColor "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'red'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将修改后的列表项从新的Document对象中移除，并添加回原始文档中")]),t._v("\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("listItem"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br")])]),a("ul",[a("li",[t._v("脱离文档流\n将一些"),a("code",[t._v("持续性动画效果")]),t._v("，可以使用"),a("code",[t._v("float、position：absolute")]),t._v("使其"),a("code",[t._v("脱离文档")]),t._v("流，从而"),a("code",[t._v("减少页面回流和重绘次数")]),t._v("。")])]),t._v(" "),a("h2",{attrs:{id:"重绘"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重绘"}},[t._v("#")]),t._v(" 重绘")]),t._v(" "),a("p",[t._v("重绘是浏览器根据"),a("code",[t._v("元素最新的样式重新绘制界面")]),t._v("。当元素的"),a("code",[t._v("颜色")]),t._v("。"),a("code",[t._v("背景色")]),t._v("、"),a("code",[t._v("边框")]),t._v("等"),a("code",[t._v("不影响布局")]),t._v("的 "),a("code",[t._v("属性")]),t._v("发生变化的时候，会"),a("code",[t._v("触发重绘")]),t._v("。重绘消耗的成本较低，因为他只涉及到重新绘制元素的外观。")]),t._v(" "),a("h2",{attrs:{id:"小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),a("ul",[a("li",[t._v("页面渲染流程包含DNS查询、TCP握手、TLS握手、响应、解析、渲染流程")]),t._v(" "),a("li",[t._v("解析过程会构建DOM、CSSOM，两者是同步进行的，遇到脚本，还有进行脚本"),a("code",[t._v("解析、编译、解释")])]),t._v(" "),a("li",[t._v("当"),a("code",[t._v("构建DOM")]),t._v(" 遇到 "),a("code",[t._v("普通脚本")]),t._v("（"),a("code",[t._v("非defer或async")]),t._v("）会"),a("code",[t._v("阻塞DOM构建")]),t._v("，直至其加载并执行完毕")]),t._v(" "),a("li",[t._v("当遇到"),a("code",[t._v("css")]),t._v("文件时，"),a("code",[t._v("不会阻塞DOM构建")]),t._v("，但"),a("code",[t._v("会阻塞JavaScript脚本执行")])]),t._v(" "),a("li",[t._v("构建完DOM后，"),a("code",[t._v("并不是立马可以进行交互")]),t._v("，因为有可能还有"),a("code",[t._v("异步脚本需要加载和执行")]),t._v("，或者某些脚本"),a("code",[t._v("注册了onload事件")]),t._v("，将会执行这些代码。")]),t._v(" "),a("li",[a("code",[t._v("预加载扫码器")]),t._v("会"),a("code",[t._v("优化一部分资源加载和执行")])]),t._v(" "),a("li",[t._v("渲染节点，需要DOM和CSSOM 一起结合生产渲染树，这个是浏览器进行样式、布局、绘制、合成的基础")]),t._v(" "),a("li",[t._v("回流发生在布局发生变化时，重绘发生在不影响布局的属性发生变化，重新绘制页面")]),t._v(" "),a("li",[t._v("发生回流一定会引起重绘")])])])])])}),[],!1,null,null,null);a.default=e.exports}}]);